import{p as H,r as G,c as C,C as $,g as v,o as t,b as h,q as _,a as r,i as u,x as E,T as O,e as o,t as c,n as m,F as x,h as g,u as b,O as I,P as L}from"./app-CyUPfJQf.js";import j from"./FormField-XV-VBm47.js";import{u as R}from"./index-Cwcf3g0y.js";import J from"./Spinnercomponent-afxuWD1f.js";import{_ as Q}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./index-CjJ3LkBo.js";import"./country-DJW8tnyE.js";const W={class:"relative flex h-[90vh] w-lg flex-col overflow-hidden rounded-2xl bg-white p-6 shadow-xl"},X={class:"mb-4 flex items-center justify-between"},Y={class:"text-xl font-semibold text-gray-800"},Z={key:0,class:"text-sm text-gray-500 mt-1"},K=["disabled"],ee={key:0,class:"mb-4 flex gap-2 flex-wrap"},te={key:2,class:"inline-flex items-center rounded-full bg-purple-100 px-3 py-1 text-xs font-medium text-purple-800"},se={class:"flex-1 space-y-4 overflow-y-auto px-2"},oe={class:"cursor-pointer"},re=["onClick"],le={class:"flex items-center gap-2 flex-1 min-w-0"},ae={key:0,class:"text-xs text-blue-600 whitespace-nowrap"},ie=["disabled"],ne={key:1},de=H({__name:"UpdateOffre",props:{row:{},assign:{}},emits:["close"],setup(A,{emit:D}){const a=A,F=D,{fieldAddOffre:k,newOffre:i,fieldAddDocument:V,submitOffre:M}=R(),f=G(!1),y=C(()=>!!a.row),p=C(()=>a.row&&a.row.uuid),P=()=>{a.row&&p.value&&(Object.keys(a.row).forEach(e=>{if(e in i.offre&&a.row[e]!==void 0){let s=a.row[e];if(typeof s=="string"&&/^\d{2}\/\d{2}\/\d{4}$/.test(s)){const[l,n,d]=s.split("/");s=`${d}-${n}-${l}`}e==="is_published"&&(s=s==="Publiée"),i.offre[e]=s}}),a.row.files&&a.row.files.length>0&&(i.document=a.row.files.map(e=>({name:e.path.split("/").pop()||"Document",path:e.path,isExisting:!0}))))},B=()=>{Object.keys(i.offre).forEach(e=>{i.offre[e]=""}),i.document=[]},w=()=>{B(),F("close")},U=e=>{i.document.splice(e,1)},z=async()=>{if(!f.value){f.value=!0;try{await M(i),w()}catch(e){console.error("Erreur lors de la soumission:",e)}finally{f.value=!1}}},S=e=>{e&&(i.document[0]=e)},T=e=>{if(e!=="published_at")return!1;const[s,l,n]=a.row[e].split("/");return new Date(`${n}-${l}-${s}`)<new Date};return $(y,e=>{e?(document.body.style.overflow="hidden",P()):document.body.style.overflow=""}),$(()=>a.assign,e=>{e&&(k[2][0].options=e.map(s=>({label:s.fullname,value:s.id})))},{immediate:!0}),(e,s)=>(t(),v(L,{to:"body"},[h(O,{name:"fade"},{default:_(()=>[y.value?(t(),r("div",{key:0,class:"fixed inset-0 z-50 flex items-center justify-center overflow-auto bg-black/50 p-4",onClick:E(w,["self"])},[h(O,{name:"scale"},{default:_(()=>[y.value?(t(),r("form",{key:0,onSubmit:E(z,["prevent"]),class:"w-full max-w-2xl"},[o("div",W,[o("div",X,[o("div",null,[o("h2",Y,c(p.value?"Edit Publication":"Ajouter une publication"),1),p.value&&e.row?.reference?(t(),r("p",Z," Référence: "+c(e.row.reference),1)):u("",!0)]),o("button",{type:"button",disabled:f.value,onClick:w,class:"text-gray-500 transition-colors hover:text-gray-700 disabled:opacity-50","aria-label":"Fermer"},[...s[0]||(s[0]=[o("i",{class:"uil uil-times text-2xl"},null,-1)])],8,K)]),p.value?(t(),r("div",ee,[e.row?.is_published?(t(),r("span",{key:0,class:m(["inline-flex items-center rounded-full px-3 py-1 text-xs font-medium",e.row.is_published==="Publiée"?"bg-green-100 text-green-800":"bg-gray-100 text-gray-800"])},c(e.row.is_published),3)):u("",!0),e.row?.is_closed?(t(),r("span",{key:1,class:m(["inline-flex items-center rounded-full px-3 py-1 text-xs font-medium",e.row.is_closed==="Ouverte"?"bg-blue-100 text-blue-800":"bg-red-100 text-red-800"])},c(e.row.is_closed),3)):u("",!0),e.row?.candidates_count!==void 0?(t(),r("span",te,c(e.row.candidates_count)+" candidat"+c(e.row.candidates_count>1?"s":""),1)):u("",!0)])):u("",!0),o("div",se,[(t(!0),r(x,null,g(b(k),(l,n)=>(t(),r("div",{key:`groupe-${n}`,class:"flex items-end gap-2"},[(t(!0),r(x,null,g(l,(d,N)=>(t(),v(j,{key:`field-${n}-${N}`,label:d.label,field:d,modelValue:b(i).offre[d.key],"onUpdate:modelValue":q=>b(i).offre[d.key]=q,disabled:T(d.key)},null,8,["label","field","modelValue","onUpdate:modelValue","disabled"]))),128))]))),128)),(t(!0),r(x,null,g(b(V),(l,n)=>(t(),r("div",{key:`doc-${n}`,class:"w-full"},[o("label",oe,[h(j,{field:l,onChange:S},null,8,["field"]),s[1]||(s[1]=o("div",{class:"flex w-full flex-col border border-dashed border-gray-300 p-4 text-center transition-colors hover:border-primary hover:bg-gray-50"},[o("span",{class:"mb-2 text-sm text-gray-600"}," Cliquez ici pour télécharger un fichier "),o("span",{class:"mx-auto flex items-center justify-center rounded border border-green-300 bg-green-100 p-2 text-green-800"},[o("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24","aria-hidden":"true"},[o("path",{fill:"currentColor",d:"M19.35 10.04A7.49 7.49 0 0 0 12 4C9.11 4 6.6 5.64 5.35 8.04A5.994 5.994 0 0 0 0 14c0 3.31 2.69 6 6 6h13c2.76 0 5-2.24 5-5c0-2.64-2.05-4.78-4.65-4.96M19 18H6c-2.21 0-4-1.79-4-4c0-2.05 1.53-3.76 3.56-3.97l1.07-.11l.5-.95A5.47 5.47 0 0 1 12 6c2.62 0 4.88 1.86 5.39 4.43l.3 1.5l1.53.11A2.98 2.98 0 0 1 22 15c0 1.65-1.35 3-3 3M8 13h2.55v3h2.9v-3H16l-4-4z"})])])],-1))])]))),128)),h(I,{name:"list",tag:"div",class:"space-y-2"},{default:_(()=>[(t(!0),r(x,null,g(b(i).document,(l,n)=>(t(),r("div",{key:`file-${l.name||n}`,class:m(["group flex cursor-pointer items-center justify-between rounded border p-3 transition-colors",l.isExisting?"border-blue-200 bg-blue-50 hover:bg-blue-100":"border-gray-200 bg-gray-50 hover:bg-red-50 hover:border-red-300"]),onClick:d=>U(n)},[o("div",le,[o("i",{class:m(["uil text-lg",l.isExisting?"uil-file-check-alt text-blue-600":"uil-file text-gray-600"])},null,2),o("span",{class:m(["truncate text-sm",l.isExisting?"text-blue-700":"text-gray-700"])},c(l.name),3),l.isExisting?(t(),r("span",ae," (existant) ")):u("",!0)])],10,re))),128))]),_:1})]),o("button",{type:"submit",disabled:f.value,class:"mt-4 flex w-full items-center justify-center rounded-md bg-primary p-3 text-white transition-opacity hover:opacity-90 disabled:cursor-not-allowed disabled:opacity-70"},[f.value?(t(),v(J,{key:0})):(t(),r("span",ne,c(p.value?"Update":"Enregistrer"),1))],8,ie)])],32)):u("",!0)]),_:1})])):u("",!0)]),_:1})]))}}),xe=Q(de,[["__scopeId","data-v-41aa62d6"]]);export{xe as default};
