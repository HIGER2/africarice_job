import{l as q,r as H,A as k,C as G,e as v,o as t,a as h,m as _,c as o,g as u,q as C,T as $,b as s,t as c,n as m,F as x,f as y,u as b,O as I,P as L}from"./app-BnWUzFnP.js";import E from"./FormField-CJjeySJf.js";import{u as R}from"./index-BmQEPH_6.js";import J from"./Spinnercomponent-C91I4hhy.js";import{_ as Q}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./index-CX19wX2R.js";import"./country-DJW8tnyE.js";const W={class:"relative flex h-[90vh] w-lg flex-col overflow-hidden rounded-2xl bg-white p-6 shadow-xl"},X={class:"mb-4 flex items-center justify-between"},Y={class:"text-xl font-semibold text-gray-800"},Z={key:0,class:"text-sm text-gray-500 mt-1"},K=["disabled"],ee={key:0,class:"mb-4 flex gap-2 flex-wrap"},te={key:2,class:"inline-flex items-center rounded-full bg-purple-100 px-3 py-1 text-xs font-medium text-purple-800"},se={class:"flex-1 space-y-4 overflow-y-auto px-2"},oe={class:"cursor-pointer"},re=["onClick"],le={class:"flex items-center gap-2 flex-1 min-w-0"},ae={key:0,class:"text-xs text-blue-600 whitespace-nowrap"},ie=["disabled"],ne={key:1},de=q({__name:"UpdateOffre",props:{row:{}},emits:["close"],setup(O,{emit:A}){const i=O,j=A,{fieldAddOffre:D,newOffre:a,fieldAddDocument:F,submitOffre:V}=R(),f=H(!1),g=k(()=>!!i.row),p=k(()=>i.row&&i.row.uuid),M=()=>{i.row&&p.value&&(Object.keys(i.row).forEach(e=>{if(e in a.offre&&i.row[e]!==void 0){let r=i.row[e];if(typeof r=="string"&&/^\d{2}\/\d{2}\/\d{4}$/.test(r)){const[l,n,d]=r.split("/");r=`${d}-${n}-${l}`}e==="is_published"&&(r=r==="Publiée"),a.offre[e]=r}}),i.row.files&&i.row.files.length>0&&(a.document=i.row.files.map(e=>({name:e.path.split("/").pop()||"Document",path:e.path,isExisting:!0}))))},P=()=>{Object.keys(a.offre).forEach(e=>{a.offre[e]=""}),a.document=[]},w=()=>{P(),j("close")},B=e=>{a.document.splice(e,1)},U=async()=>{if(!f.value){f.value=!0;try{await V(a),w()}catch(e){console.error("Erreur lors de la soumission:",e)}finally{f.value=!1}}},z=e=>{e&&(a.document[0]=e)},S=e=>{if(e!=="published_at")return!1;const[r,l,n]=i.row[e].split("/");return new Date(`${n}-${l}-${r}`)<new Date};return G(g,e=>{e?(document.body.style.overflow="hidden",M()):document.body.style.overflow=""}),(e,r)=>(t(),v(L,{to:"body"},[h($,{name:"fade"},{default:_(()=>[g.value?(t(),o("div",{key:0,class:"fixed inset-0 z-50 flex items-center justify-center overflow-auto bg-black/50 p-4",onClick:C(w,["self"])},[h($,{name:"scale"},{default:_(()=>[g.value?(t(),o("form",{key:0,onSubmit:C(U,["prevent"]),class:"w-full max-w-2xl"},[s("div",W,[s("div",X,[s("div",null,[s("h2",Y,c(p.value?"Edit Publication":"Ajouter une publication"),1),p.value&&e.row?.reference?(t(),o("p",Z," Référence: "+c(e.row.reference),1)):u("",!0)]),s("button",{type:"button",disabled:f.value,onClick:w,class:"text-gray-500 transition-colors hover:text-gray-700 disabled:opacity-50","aria-label":"Fermer"},[...r[0]||(r[0]=[s("i",{class:"uil uil-times text-2xl"},null,-1)])],8,K)]),p.value?(t(),o("div",ee,[e.row?.is_published?(t(),o("span",{key:0,class:m(["inline-flex items-center rounded-full px-3 py-1 text-xs font-medium",e.row.is_published==="Publiée"?"bg-green-100 text-green-800":"bg-gray-100 text-gray-800"])},c(e.row.is_published),3)):u("",!0),e.row?.is_closed?(t(),o("span",{key:1,class:m(["inline-flex items-center rounded-full px-3 py-1 text-xs font-medium",e.row.is_closed==="Ouverte"?"bg-blue-100 text-blue-800":"bg-red-100 text-red-800"])},c(e.row.is_closed),3)):u("",!0),e.row?.candidates_count!==void 0?(t(),o("span",te,c(e.row.candidates_count)+" candidat"+c(e.row.candidates_count>1?"s":""),1)):u("",!0)])):u("",!0),s("div",se,[(t(!0),o(x,null,y(b(D),(l,n)=>(t(),o("div",{key:`groupe-${n}`,class:"flex flex-col gap-3"},[(t(!0),o(x,null,y(l,(d,T)=>(t(),v(E,{key:`field-${n}-${T}`,label:d.label,field:d,modelValue:b(a).offre[d.key],"onUpdate:modelValue":N=>b(a).offre[d.key]=N,disabled:S(d.key)},null,8,["label","field","modelValue","onUpdate:modelValue","disabled"]))),128))]))),128)),(t(!0),o(x,null,y(b(F),(l,n)=>(t(),o("div",{key:`doc-${n}`,class:"w-full"},[s("label",oe,[h(E,{field:l,onChange:z},null,8,["field"]),r[1]||(r[1]=s("div",{class:"flex w-full flex-col border border-dashed border-gray-300 p-4 text-center transition-colors hover:border-primary hover:bg-gray-50"},[s("span",{class:"mb-2 text-sm text-gray-600"}," Cliquez ici pour télécharger un fichier "),s("span",{class:"mx-auto flex items-center justify-center rounded border border-green-300 bg-green-100 p-2 text-green-800"},[s("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24","aria-hidden":"true"},[s("path",{fill:"currentColor",d:"M19.35 10.04A7.49 7.49 0 0 0 12 4C9.11 4 6.6 5.64 5.35 8.04A5.994 5.994 0 0 0 0 14c0 3.31 2.69 6 6 6h13c2.76 0 5-2.24 5-5c0-2.64-2.05-4.78-4.65-4.96M19 18H6c-2.21 0-4-1.79-4-4c0-2.05 1.53-3.76 3.56-3.97l1.07-.11l.5-.95A5.47 5.47 0 0 1 12 6c2.62 0 4.88 1.86 5.39 4.43l.3 1.5l1.53.11A2.98 2.98 0 0 1 22 15c0 1.65-1.35 3-3 3M8 13h2.55v3h2.9v-3H16l-4-4z"})])])],-1))])]))),128)),h(I,{name:"list",tag:"div",class:"space-y-2"},{default:_(()=>[(t(!0),o(x,null,y(b(a).document,(l,n)=>(t(),o("div",{key:`file-${l.name||n}`,class:m(["group flex cursor-pointer items-center justify-between rounded border p-3 transition-colors",l.isExisting?"border-blue-200 bg-blue-50 hover:bg-blue-100":"border-gray-200 bg-gray-50 hover:bg-red-50 hover:border-red-300"]),onClick:d=>B(n)},[s("div",le,[s("i",{class:m(["uil text-lg",l.isExisting?"uil-file-check-alt text-blue-600":"uil-file text-gray-600"])},null,2),s("span",{class:m(["truncate text-sm",l.isExisting?"text-blue-700":"text-gray-700"])},c(l.name),3),l.isExisting?(t(),o("span",ae," (existant) ")):u("",!0)])],10,re))),128))]),_:1})]),s("button",{type:"submit",disabled:f.value,class:"mt-4 flex w-full items-center justify-center rounded-md bg-primary p-3 text-white transition-opacity hover:opacity-90 disabled:cursor-not-allowed disabled:opacity-70"},[f.value?(t(),v(J,{key:0})):(t(),o("span",ne,c(p.value?"Update":"Enregistrer"),1))],8,ie)])],32)):u("",!0)]),_:1})])):u("",!0)]),_:1})]))}}),xe=Q(de,[["__scopeId","data-v-0a4bad49"]]);export{xe as default};
