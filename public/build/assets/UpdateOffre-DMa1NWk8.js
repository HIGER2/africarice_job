import{l as P,r as q,A as k,C as H,e as v,o as t,a as x,m as _,c as o,g as d,q as C,T as E,b as s,t as u,n as m,F as h,f as g,u as b,O as G,P as I}from"./app-7tJZUXBD.js";import $ from"./FormField-B_YfEh3a.js";import{u as L}from"./index--mydlpcv.js";import R from"./Spinnercomponent-BnZA-k5_.js";import{_ as J}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./index-DfbPFWse.js";const K={class:"relative flex h-[90vh] w-lg flex-col overflow-hidden rounded-2xl bg-white p-6 shadow-xl"},Q={class:"mb-4 flex items-center justify-between"},W={class:"text-xl font-semibold text-gray-800"},X={key:0,class:"text-sm text-gray-500 mt-1"},Y=["disabled"],Z={key:0,class:"mb-4 flex gap-2 flex-wrap"},ee={key:2,class:"inline-flex items-center rounded-full bg-purple-100 px-3 py-1 text-xs font-medium text-purple-800"},te={class:"flex-1 space-y-4 overflow-y-auto px-2"},se={class:"cursor-pointer"},oe=["onClick"],re={class:"flex items-center gap-2 flex-1 min-w-0"},le={key:0,class:"text-xs text-blue-600 whitespace-nowrap"},ae=["disabled"],ie={key:1},ne=P({__name:"UpdateOffre",props:{row:{}},emits:["close"],setup(O,{emit:j}){const i=O,A=j,{fieldAddOffre:M,newOffre:r,fieldAddDocument:F,submitOffre:V}=L(),f=q(!1),y=k(()=>!!i.row),p=k(()=>i.row&&i.row.uuid),B=()=>{i.row&&p.value&&(Object.keys(i.row).forEach(e=>{if(e in r.offre&&i.row[e]!==void 0){let l=i.row[e];if(typeof l=="string"&&/^\d{2}\/\d{2}\/\d{4}$/.test(l)){const[a,n,c]=l.split("/");l=`${c}-${n}-${a}`}e==="is_published"&&(l=l==="Publiée"),r.offre[e]=l}}),i.row.files&&i.row.files.length>0&&(r.document=i.row.files.map(e=>({name:e.path.split("/").pop()||"Document",path:e.path,isExisting:!0}))))},z=()=>{Object.keys(r.offre).forEach(e=>{r.offre[e]=""}),r.document=[]},w=()=>{z(),A("close")},D=e=>{r.document.splice(e,1)},S=async()=>{if(!f.value){f.value=!0;try{await V(r),w()}catch(e){console.error("Erreur lors de la soumission:",e)}finally{f.value=!1}}},T=e=>{e&&r.document.push(e)};return H(y,e=>{e?(document.body.style.overflow="hidden",B()):document.body.style.overflow=""}),(e,l)=>(t(),v(I,{to:"body"},[x(E,{name:"fade"},{default:_(()=>[y.value?(t(),o("div",{key:0,class:"fixed inset-0 z-50 flex items-center justify-center overflow-auto bg-black/50 p-4",onClick:C(w,["self"])},[x(E,{name:"scale"},{default:_(()=>[y.value?(t(),o("form",{key:0,onSubmit:C(S,["prevent"]),class:"w-full max-w-2xl"},[s("div",K,[s("div",Q,[s("div",null,[s("h2",W,u(p.value?"Modifier la publication":"Ajouter une publication"),1),p.value&&e.row?.reference?(t(),o("p",X," Référence: "+u(e.row.reference),1)):d("",!0)]),s("button",{type:"button",disabled:f.value,onClick:w,class:"text-gray-500 transition-colors hover:text-gray-700 disabled:opacity-50","aria-label":"Fermer"},[...l[0]||(l[0]=[s("i",{class:"uil uil-times text-2xl"},null,-1)])],8,Y)]),p.value?(t(),o("div",Z,[e.row?.is_published?(t(),o("span",{key:0,class:m(["inline-flex items-center rounded-full px-3 py-1 text-xs font-medium",e.row.is_published==="Publiée"?"bg-green-100 text-green-800":"bg-gray-100 text-gray-800"])},u(e.row.is_published),3)):d("",!0),e.row?.is_closed?(t(),o("span",{key:1,class:m(["inline-flex items-center rounded-full px-3 py-1 text-xs font-medium",e.row.is_closed==="Ouverte"?"bg-blue-100 text-blue-800":"bg-red-100 text-red-800"])},u(e.row.is_closed),3)):d("",!0),e.row?.candidates_count!==void 0?(t(),o("span",ee,u(e.row.candidates_count)+" candidat"+u(e.row.candidates_count>1?"s":""),1)):d("",!0)])):d("",!0),s("div",te,[(t(!0),o(h,null,g(b(M),(a,n)=>(t(),o("div",{key:`groupe-${n}`,class:"flex flex-col gap-3"},[(t(!0),o(h,null,g(a,(c,U)=>(t(),v($,{key:`field-${n}-${U}`,label:c.label,field:c,modelValue:b(r).offre[c.key],"onUpdate:modelValue":N=>b(r).offre[c.key]=N},null,8,["label","field","modelValue","onUpdate:modelValue"]))),128))]))),128)),(t(!0),o(h,null,g(b(F),(a,n)=>(t(),o("div",{key:`doc-${n}`,class:"w-full"},[s("label",se,[x($,{field:a,onChange:T},null,8,["field"]),l[1]||(l[1]=s("div",{class:"flex w-full flex-col border border-dashed border-gray-300 p-4 text-center transition-colors hover:border-primary hover:bg-gray-50"},[s("span",{class:"mb-2 text-sm text-gray-600"}," Cliquez ici pour télécharger un fichier "),s("span",{class:"mx-auto flex items-center justify-center rounded border border-green-300 bg-green-100 p-2 text-green-800"},[s("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24","aria-hidden":"true"},[s("path",{fill:"currentColor",d:"M19.35 10.04A7.49 7.49 0 0 0 12 4C9.11 4 6.6 5.64 5.35 8.04A5.994 5.994 0 0 0 0 14c0 3.31 2.69 6 6 6h13c2.76 0 5-2.24 5-5c0-2.64-2.05-4.78-4.65-4.96M19 18H6c-2.21 0-4-1.79-4-4c0-2.05 1.53-3.76 3.56-3.97l1.07-.11l.5-.95A5.47 5.47 0 0 1 12 6c2.62 0 4.88 1.86 5.39 4.43l.3 1.5l1.53.11A2.98 2.98 0 0 1 22 15c0 1.65-1.35 3-3 3M8 13h2.55v3h2.9v-3H16l-4-4z"})])])],-1))])]))),128)),x(G,{name:"list",tag:"div",class:"space-y-2"},{default:_(()=>[(t(!0),o(h,null,g(b(r).document,(a,n)=>(t(),o("div",{key:`file-${a.name||n}`,class:m(["group flex cursor-pointer items-center justify-between rounded border p-3 transition-colors",a.isExisting?"border-blue-200 bg-blue-50 hover:bg-blue-100":"border-gray-200 bg-gray-50 hover:bg-red-50 hover:border-red-300"]),onClick:c=>D(n)},[s("div",re,[s("i",{class:m(["uil text-lg",a.isExisting?"uil-file-check-alt text-blue-600":"uil-file text-gray-600"])},null,2),s("span",{class:m(["truncate text-sm",a.isExisting?"text-blue-700":"text-gray-700"])},u(a.name),3),a.isExisting?(t(),o("span",le," (existant) ")):d("",!0)])],10,oe))),128))]),_:1})]),s("button",{type:"submit",disabled:f.value,class:"mt-4 flex w-full items-center justify-center rounded-md bg-primary p-3 text-white transition-opacity hover:opacity-90 disabled:cursor-not-allowed disabled:opacity-70"},[f.value?(t(),v(R,{key:0})):(t(),o("span",ie,u(p.value?"Mettre à jour":"Enregistrer"),1))],8,ae)])],32)):d("",!0)]),_:1})])):d("",!0)]),_:1})]))}}),be=J(ne,[["__scopeId","data-v-697a98ee"]]);export{be as default};
